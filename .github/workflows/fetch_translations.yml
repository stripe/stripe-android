name: Fetch Lokalize translations
on:
  workflow_dispatch:
  schedule:
    # Every Monday at 10 AM East Coast time / 7 AM West Coast time / 2 PM UTC
    - cron: "0 14 * * 1"
jobs:
  fetch-lokalize-translations:
    runs-on: macos-latest
    steps:
      # Check out the current state
      - uses: actions/checkout@v3

      # Fetch translations
      - name: Run build script
        run: cd scripts && ./localize.sh
        shell: bash
        env:
          LOKALISE_API_TOKEN: ${{ secrets.LOKALISE_API_TOKEN }}

      # Create timestamp
      - name: Get timestamp
        id: timestamp
        run: echo "TIMESTAMP=$(date +'%Y%m%d-%H%M%S')" >> $GITHUB_OUTPUT

      # Create the pull request
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: Fetch latest Lokalize translations
          title: Update translations
          body: This pull request contains the latest translations from Lokalize.
          branch: update-translations-${{ steps.timestamp.outputs.TIMESTAMP }}
          base: master
