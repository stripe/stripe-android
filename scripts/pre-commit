#!/bin/bash
#
# Pre-commit hook that runs the same checks as the Bitrise "check" workflow
# See bitrise.yml for reference
#
# To install this hook, run: ./scripts/install-git-hooks.sh

set -e

echo "Running pre-commit checks (same as Bitrise 'check' workflow)..."
echo ""

# Run detekt with auto-retry (detekt can autofix issues, so try twice)
echo "Running detekt..."
if ! ./gradlew detekt; then
    echo "Detekt failed, running again after autofixes..."
    ./gradlew detekt
fi

# Run the rest of the checks
./gradlew ktlint lintRelease apiCheck verifyReleaseResources

echo ""
echo "âœ“ All checks passed!"
