apply from: configs.androidApplication

apply plugin: 'com.emergetools.android'
apply plugin: 'com.google.firebase.appdistribution'
apply plugin: 'org.jetbrains.kotlin.plugin.serialization'
apply plugin: 'org.jetbrains.kotlin.plugin.compose'

emerge {
    // Api token is implicitly set to the EMERGE_API_TOKEN env variable

    size {
        tag.set(System.getenv("EMERGE_TAG"))
    }

    vcs {
        gitHub {
            repoOwner.set("stripe")
            repoName.set("stripe-android")
        }
    }
}

android {
    defaultConfig {
        applicationId "com.stripe.android.form.example"

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"

        versionName VERSION_NAME
        versionCode getVersionCode(versionName)
    }

    buildFeatures {
        compose true
    }

    testOptions {
        unitTests {
            // Note: without this, all Robolectric tests using assets will fail.
            includeAndroidResources = true
            all {
                maxHeapSize = "1024m"
            }
        }

        kotlinOptions {
            freeCompilerArgs += ["-opt-in=kotlinx.coroutines.ExperimentalCoroutinesApi"]
        }

        managedDevices {
            localDevices {
                register("pixel2api33") {
                    device = "Pixel 2"
                    apiLevel = 33
                    systemImageSource = "aosp"
                }
            }
        }
    }
}

dependencies {
    implementation project(":form")

    implementation libs.androidx.activity
    implementation libs.androidx.appCompat
    implementation libs.androidx.coreKtx
    implementation libs.androidx.lifecycle
    implementation libs.compose.activity
    implementation libs.compose.material
    implementation libs.compose.materialIcons
    implementation libs.compose.ui
    implementation libs.compose.uiToolingPreview
    implementation libs.compose.navigation
    implementation libs.loggingInterceptor
    implementation libs.material
    implementation platform('androidx.compose:compose-bom:2024.04.01')
    implementation 'androidx.compose.ui:ui-graphics'
    implementation 'androidx.compose.material3:material3'
    androidTestImplementation platform('androidx.compose:compose-bom:2024.04.01')

    debugImplementation libs.compose.uiTestManifest
    debugImplementation libs.compose.uiTooling
    debugImplementation libs.leakCanary

    testImplementation project(':screenshot-testing')

    testImplementation testLibs.androidx.archCore
    testImplementation testLibs.androidx.composeUi
    testImplementation testLibs.androidx.core
    testImplementation testLibs.androidx.fragment
    testImplementation testLibs.androidx.junit
    testImplementation testLibs.androidx.junitKtx
    testImplementation testLibs.androidx.lifecycle
    testImplementation testLibs.androidx.testRules
    testImplementation testLibs.hamcrest
    testImplementation testLibs.junit
    testImplementation testLibs.json
    testImplementation testLibs.kotlin.annotations
    testImplementation testLibs.kotlin.coroutines
    testImplementation testLibs.kotlin.junit
    testImplementation testLibs.mockito.core
    testImplementation testLibs.mockito.inline
    testImplementation testLibs.mockito.kotlin
    testImplementation testLibs.robolectric
    testImplementation testLibs.truth
    testImplementation testLibs.turbine
    testImplementation testLibs.espresso.intents

    testImplementation testLibs.espresso.core

    androidTestImplementation testLibs.espresso.core
    androidTestImplementation testLibs.androidx.composeUi
}
